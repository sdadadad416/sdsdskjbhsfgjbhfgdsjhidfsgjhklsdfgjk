name: Free Windows Desktop with Guacamole + Cloudflare Tunnel

on: workflow_dispatch

jobs:
  setup-guacamole-tunnel:
    runs-on: windows-latest
    steps:
    - name: Check out the repository
      uses: actions/checkout@v2

    - name: Enable RDP Server
      run: |
        Write-Host "üñ•Ô∏è –í–∫–ª—é—á–∞–µ–º RDP —Å–µ—Ä–≤–µ—Ä..."
        try {
            # –í–∫–ª—é—á–∞–µ–º RDP
            Set-ItemProperty -Path 'HKLM:\System\CurrentControlSet\Control\Terminal Server' -Name "fDenyTSConnections" -Value 0
            Set-ItemProperty -Path 'HKLM:\System\CurrentControlSet\Control\Terminal Server\WinStations\RDP-Tcp' -Name "UserAuthentication" -Value 1
            
            # –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –±—Ä–∞–Ω–¥–º–∞—É—ç—Ä–∞
            Enable-NetFirewallRule -DisplayGroup "Remote Desktop"
            New-NetFirewallRule -DisplayName "Allow RDP" -Direction Inbound -Protocol TCP -LocalPort 3389 -Action Allow -ErrorAction SilentlyContinue
            
            # –í–∫–ª—é—á–µ–Ω–∏–µ –∑–≤—É–∫–∞
            Set-ItemProperty -Path 'HKLM:\System\CurrentControlSet\Control\Terminal Server\WinStations\RDP-Tcp' -Name "fDisableAudio" -Value 0
            Start-Service -Name "Audiosrv" -ErrorAction SilentlyContinue
            Set-Service -Name "Audiosrv" -StartupType Automatic -ErrorAction SilentlyContinue
            
            # –í–∫–ª—é—á–µ–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–∞ —Ç–µ—Ä–º–∏–Ω–∞–ª–æ–≤
            Start-Service -Name "TermService" -ErrorAction SilentlyContinue
            Set-Service -Name "TermService" -StartupType Automatic -ErrorAction SilentlyContinue
            
            Write-Host "‚úÖ RDP —Å–µ—Ä–≤–µ—Ä –≤–∫–ª—é—á–µ–Ω —É—Å–ø–µ—à–Ω–æ!"
        } catch {
            Write-Host "‚ùå –û—à–∏–±–∫–∞ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ RDP: $($_.Exception.Message)"
        }
        Start-Sleep -Seconds 5

    - name: Setup Web Interface
      run: |
        Write-Host "üåê –°–æ–∑–¥–∞–µ–º –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å..."
        
        # –°–æ–∑–¥–∞–µ–º –ø—Ä–æ—Å—Ç–æ–π HTML —Ñ–∞–π–ª –ø–æ —á–∞—Å—Ç—è–º
        $htmlStart = '<!DOCTYPE html><html><head><meta charset="UTF-8"><title>Windows Desktop</title>'
        $htmlStyle = '<style>body{margin:0;padding:20px;font-family:Arial;background:#2c3e50;color:white}.container{max-width:800px;margin:0 auto}.info{background:#34495e;padding:15px;margin:10px 0;border-radius:8px}.cred{background:#2c3e50;padding:10px;margin:5px 0}a{color:#3498db;text-decoration:none;margin-right:15px}</style>'
        $htmlBody = '</head><body><div class="container"><h1>Windows Desktop Access</h1><div class="info"><h3>–î–∞–Ω–Ω—ã–µ –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è:</h3><div class="cred"><strong>–°–µ—Ä–≤–µ—Ä:</strong> localhost:3389</div><div class="cred"><strong>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å:</strong> runneradmin</div><div class="cred"><strong>–ü–∞—Ä–æ–ª—å:</strong> Desktop2024!</div></div><div class="info"><h3>–°–ø–æ—Å–æ–±—ã –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è:</h3><a href="#" onclick="downloadRDP()">–°–∫–∞—á–∞—Ç—å .rdp —Ñ–∞–π–ª</a><a href="rdp://runneradmin:Desktop2024!@localhost:3389">–û—Ç–∫—Ä—ã—Ç—å RDP</a></div></div>'
        $htmlScript = '<script>function downloadRDP(){const content="screen mode id:i:2\ndesktopwidth:i:1024\ndesktopheight:i:768\nfull address:s:localhost:3389\nusername:s:runneradmin";const blob=new Blob([content],{type:"application/rdp"});const url=URL.createObjectURL(blob);const a=document.createElement("a");a.href=url;a.download="windows.rdp";a.click();URL.revokeObjectURL(url);}</script>'
        $htmlEnd = '</body></html>'
        
        # –û–±—ä–µ–¥–∏–Ω—è–µ–º –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ–º
        $fullHtml = $htmlStart + $htmlStyle + $htmlBody + $htmlScript + $htmlEnd
        $fullHtml | Out-File -FilePath "$env:USERPROFILE\index.html" -Encoding UTF8
        
        Write-Host "‚úÖ –í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å —Å–æ–∑–¥–∞–Ω"

    - name: Setup Python HTTP Server
      run: |
        Write-Host "üêç –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º Python HTTP —Å–µ—Ä–≤–µ—Ä..."
        
        # Python —É–∂–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –≤ GitHub Actions
        python -m pip install --upgrade pip
        
        # –ó–∞–ø—É—Å–∫–∞–µ–º HTTP —Å–µ—Ä–≤–µ—Ä –¥–ª—è Guacamole –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
        $serverJob = Start-Job -ScriptBlock {
            Set-Location $env:USERPROFILE
            python -m http.server 8080
        }
        
        Start-Sleep -Seconds 10
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ —Å–µ—Ä–≤–µ—Ä —Ä–∞–±–æ—Ç–∞–µ—Ç
        try {
            $response = Invoke-WebRequest -Uri "http://localhost:8080/guacamole.html" -TimeoutSec 5
            Write-Host "‚úÖ HTTP —Å–µ—Ä–≤–µ—Ä —Ä–∞–±–æ—Ç–∞–µ—Ç: $($response.StatusCode)"
        } catch {
            Write-Host "‚ùå –û—à–∏–±–∫–∞ HTTP —Å–µ—Ä–≤–µ—Ä–∞: $($_.Exception.Message)"
        }
        
        Write-Host "‚úÖ Python HTTP —Å–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω –Ω–∞ –ø–æ—Ä—Ç—É 8080"

    - name: Download and Setup Cloudflare Tunnel
      run: |
        Write-Host "‚òÅÔ∏è –°–∫–∞—á–∏–≤–∞–µ–º Cloudflare Tunnel (cloudflared)..."
        Invoke-WebRequest -Uri "https://github.com/cloudflare/cloudflared/releases/latest/download/cloudflared-windows-amd64.exe" -OutFile "$env:USERPROFILE\cloudflared.exe"
        
        Write-Host "‚úÖ Cloudflared –≥–æ—Ç–æ–≤!"

    - name: System Setup and User Configuration
      run: |
        Write-Host "‚öôÔ∏è –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º —Å–∏—Å—Ç–µ–º—É..."
        
        # –°–æ–∑–¥–∞–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–ª—è RDP
        Write-Host "üë§ –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è..."
        Set-LocalUser -Name "runneradmin" -Password (ConvertTo-SecureString -AsPlainText "Desktop2024!" -Force)
        
        # –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∞–≤—Ç–æ–ª–æ–≥–∏–Ω–∞
        Write-Host "üîê –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –∞–≤—Ç–æ–ª–æ–≥–∏–Ω..."
        Set-ItemProperty -Path "HKLM:\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon" -Name "AutoAdminLogon" -Value "1" -Type String
        Set-ItemProperty -Path "HKLM:\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon" -Name "DefaultUserName" -Value "runneradmin" -Type String
        Set-ItemProperty -Path "HKLM:\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon" -Name "DefaultPassword" -Value "Desktop2024!" -Type String
        
        # –û—Ç–∫–ª—é—á–∞–µ–º —ç–∫—Ä–∞–Ω –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏
        Write-Host "üñ•Ô∏è –û—Ç–∫–ª—é—á–∞–µ–º –±–ª–æ–∫–∏—Ä–æ–≤–∫—É —ç–∫—Ä–∞–Ω–∞..."
        try {
            New-Item -Path "HKLM:\SOFTWARE\Policies\Microsoft\Windows" -Name "Personalization" -Force -ErrorAction SilentlyContinue
            Set-ItemProperty -Path "HKLM:\SOFTWARE\Policies\Microsoft\Windows\Personalization" -Name "NoLockScreen" -Value 1 -Type DWord -Force -ErrorAction SilentlyContinue
        } catch {
            Write-Host "‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–∫–ª—é—á–∏—Ç—å –±–ª–æ–∫–∏—Ä–æ–≤–∫—É —ç–∫—Ä–∞–Ω–∞: $($_.Exception.Message)"
        }
        
        # –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –¥–∏—Å–ø–ª–µ—è
        Write-Host "üñºÔ∏è –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ —ç–∫—Ä–∞–Ω–∞..."
        Add-Type -AssemblyName System.Windows.Forms
        $screen = [System.Windows.Forms.Screen]::PrimaryScreen
        Write-Host "–¢–µ–∫—É—â–µ–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ: $($screen.Bounds.Width)x$($screen.Bounds.Height)"
        
        Write-Host "‚å®Ô∏è –î–æ–±–∞–≤–ª—è–µ–º —Ä—É—Å—Å–∫—É—é —Ä–∞—Å–∫–ª–∞–¥–∫—É..."
        try {
            $inputLanguageID = New-WinUserLanguageList -Language "ru-RU"
            $inputLanguageID += New-WinUserLanguageList -Language "en-US"
            Set-WinUserLanguageList -LanguageList $inputLanguageID -Force
        } catch {
            Write-Host "‚ö†Ô∏è –û—à–∏–±–∫–∞ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —è–∑—ã–∫–∞: $($_.Exception.Message)"
        }
        
        Write-Host "‚úÖ –°–∏—Å—Ç–µ–º–∞ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞!"

    - name: Verify RDP Server
      run: |
        Write-Host "üîç –ü—Ä–æ–≤–µ—Ä—è–µ–º RDP —Å–µ—Ä–≤–µ—Ä..."
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ RDP —Å–ª—É—à–∞–µ—Ç –ø–æ—Ä—Ç 3389
        $rdpPort = Get-NetTCPConnection -LocalPort 3389 -ErrorAction SilentlyContinue
        if ($rdpPort) {
            Write-Host "‚úÖ RDP —Å–µ—Ä–≤–µ—Ä —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ –ø–æ—Ä—Ç—É 3389"
        } else {
            Write-Host "‚ùå RDP —Å–µ—Ä–≤–µ—Ä –Ω–µ —Å–ª—É—à–∞–µ—Ç –ø–æ—Ä—Ç 3389"
            Write-Host "üîÑ –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ–º RDP —Å–µ—Ä–≤–∏—Å..."
            Restart-Service -Name "TermService" -Force
            Start-Sleep -Seconds 10
        }
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º HTTP —Å–µ—Ä–≤–µ—Ä
        $httpPort = Get-NetTCPConnection -LocalPort 8080 -ErrorAction SilentlyContinue
        if ($httpPort) {
            Write-Host "‚úÖ HTTP —Å–µ—Ä–≤–µ—Ä —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ –ø–æ—Ä—Ç—É 8080"
        } else {
            Write-Host "‚ùå HTTP —Å–µ—Ä–≤–µ—Ä –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ –ø–æ—Ä—Ç—É 8080"
        }

    - name: Start Cloudflare Tunnel and Keep Alive
      run: |
        Write-Host "‚òÅÔ∏è –ó–∞–ø—É—Å–∫–∞–µ–º Cloudflare Tunnel..."
        
        # –ó–∞–ø—É—Å–∫–∞–µ–º cloudflared —Ç—É–Ω–Ω–µ–ª—å –≤ —Ñ–æ–Ω–µ
        Write-Host "üîó –°–æ–∑–¥–∞–µ–º —Ç—É–Ω–Ω–µ–ª—å –Ω–∞ trycloudflare.com..."
        $logFile = "$env:TEMP\cloudflared.log"
        
        # –ó–∞–ø—É—Å–∫–∞–µ–º –≤ —Ñ–æ–Ω–µ —Å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ–º
        $tunnelJob = Start-Job -ScriptBlock {
            param($cloudflaredPath, $logPath)
            & $cloudflaredPath tunnel --url http://localhost:8080 2>&1 | Tee-Object -FilePath $logPath
        } -ArgumentList "$env:USERPROFILE\cloudflared.exe", $logFile
        
        Start-Sleep -Seconds 30
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç–∞—Ç—É—Å tunnel job
        $jobState = Get-Job -Id $tunnelJob.Id | Select-Object -ExpandProperty State
        if ($jobState -eq "Running") {
            Write-Host "‚úÖ Cloudflare —Ç—É–Ω–Ω–µ–ª—å —É—Å–ø–µ—à–Ω–æ –∑–∞–ø—É—â–µ–Ω!"
        } else {
            Write-Host "‚ùå –û—à–∏–±–∫–∞ –∑–∞–ø—É—Å–∫–∞ Cloudflare Tunnel"
        }
        
        # –ü–æ–ª—É—á–∞–µ–º URL —Ç—É–Ω–Ω–µ–ª—è (–Ω–µ—Å–∫–æ–ª—å–∫–æ –ø–æ–ø—ã—Ç–æ–∫)
        $tunnelUrl = $null
        for ($i = 1; $i -le 8; $i++) {
            Write-Host "üîç –ü–æ–ø—ã—Ç–∫–∞ $i –ø–æ–ª—É—á–∏—Ç—å URL —Ç—É–Ω–Ω–µ–ª—è..."
            
            # –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤—ã–≤–æ–¥ job
            $tunnelOutput = Receive-Job -Id $tunnelJob.Id -Keep
            if ($tunnelOutput) {
                $tunnelOutput | ForEach-Object { 
                    Write-Host $_
                    if ($_ -match "https://[a-zA-Z0-9\-]+\.trycloudflare\.com") {
                        $tunnelUrl = $matches[0]
                        Write-Host "üéØ –ù–∞–π–¥–µ–Ω URL –≤ job: $tunnelUrl"
                    }
                }
            }
            
            # –ü—Ä–æ–≤–µ—Ä—è–µ–º –ª–æ–≥ —Ñ–∞–π–ª
            if (Test-Path $logFile) {
                $logContent = Get-Content $logFile -ErrorAction SilentlyContinue
                if ($logContent) {
                    $logContent | ForEach-Object { 
                        if ($_ -match "https://[a-zA-Z0-9\-]+\.trycloudflare\.com") {
                            $tunnelUrl = $matches[0]
                            Write-Host "üéØ –ù–∞–π–¥–µ–Ω URL –≤ –ª–æ–≥–µ: $tunnelUrl"
                        }
                    }
                }
            }
            
            if ($tunnelUrl) { break }
            Start-Sleep -Seconds 15
        }
        
        if (-not $tunnelUrl) {
            Write-Host "‚ö†Ô∏è URL –Ω–µ –Ω–∞–π–¥–µ–Ω, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—Å–µ –ª–æ–≥–∏:"
            Write-Host "üìã –í—ã–≤–æ–¥ Job:"
            Receive-Job -Id $tunnelJob.Id -Keep | ForEach-Object { Write-Host $_ }
            if (Test-Path $logFile) {
                Write-Host "üìã –°–æ–¥–µ—Ä–∂–∏–º–æ–µ –ª–æ–≥ —Ñ–∞–π–ª–∞:"
                Get-Content $logFile | ForEach-Object { Write-Host $_ }
            }
        }
        
        # –í—ã–≤–æ–¥–∏–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
        Write-Host ""
        Write-Host "=" * 70
        Write-Host "üåê –ò–ù–§–û–†–ú–ê–¶–ò–Ø –î–õ–Ø –ü–û–î–ö–õ–Æ–ß–ï–ù–ò–Ø –ö WINDOWS DESKTOP"
        Write-Host "=" * 70
        if ($tunnelUrl) {
            Write-Host "üîó –ü–†–Ø–ú–ê–Ø –°–°–´–õ–ö–ê: $tunnelUrl"
            Write-Host "üéØ –°–∫–æ–ø–∏—Ä—É–π—Ç–µ —ç—Ç—É —Å—Å—ã–ª–∫—É –∏ –æ—Ç–∫—Ä–æ–π—Ç–µ –≤ –±—Ä–∞—É–∑–µ—Ä–µ!"
        } else {
            Write-Host "üîó –í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å: –°–º–æ—Ç—Ä–∏—Ç–µ URL –≤—ã—à–µ –≤ –ª–æ–≥–∞—Ö Cloudflare"
            Write-Host "üîó –û—Ç–∫—Ä–æ–π—Ç–µ URL –≤ –±—Ä–∞—É–∑–µ—Ä–µ"
        }
        Write-Host ""
        Write-Host "üìã –î–∞–Ω–Ω—ã–µ –¥–ª—è RDP –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è:"
        Write-Host "üåê –°–µ—Ä–≤–µ—Ä: localhost:3389 (—á–µ—Ä–µ–∑ —Ç—É–Ω–Ω–µ–ª—å)"
        Write-Host "üë§ Windows –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: runneradmin"
        Write-Host "üîë Windows –ü–∞—Ä–æ–ª—å: Desktop2024!"
        Write-Host ""
        Write-Host "üíª –û—Ç–∫—Ä–æ–π—Ç–µ URL –≤ –±—Ä–∞—É–∑–µ—Ä–µ –¥–ª—è –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞"
        Write-Host "üñ•Ô∏è –ò–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ª—é–±–æ–π RDP –∫–ª–∏–µ–Ω—Ç"
        Write-Host "üéÆ –ü–æ–ª–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –∑–≤—É–∫–∞, –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã –∏ –º—ã—à–∏"
        Write-Host "üåç –†–∞–±–æ—Ç–∞–µ—Ç –≤ –ª—é–±–æ–º –±—Ä–∞—É–∑–µ—Ä–µ –∏ –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö"
        Write-Host "=" * 70
        Write-Host ""
        
        Write-Host "‚è∞ –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º —Ä–∞–±–æ—Ç—É —Ç—É–Ω–Ω–µ–ª—è..."
        Write-Host "üõë –î–ª—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ –ø—Ä–µ—Ä–≤–∏—Ç–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ workflow"
        Write-Host "üìä –¢—É–Ω–Ω–µ–ª—å –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ"
        
        # –û—Å–Ω–æ–≤–Ω–æ–π —Ü–∏–∫–ª –ø–æ–¥–¥–µ—Ä–∂–∞–Ω–∏—è —Ä–∞–±–æ—Ç—ã (–±–µ—Å–∫–æ–Ω–µ—á–Ω—ã–π)
        $startTime = Get-Date
        $lastCheck = Get-Date
        
        while ($true) {
            try {
                # –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–∞–∂–¥—ã–µ 3 –º–∏–Ω—É—Ç—ã
                if ((Get-Date) - $lastCheck -gt (New-TimeSpan -Minutes 3)) {
                    
                    # –ü—Ä–æ–≤–µ—Ä—è–µ–º Cloudflare tunnel
                    $currentTunnelState = Get-Job -Id $tunnelJob -ErrorAction SilentlyContinue | Select-Object -ExpandProperty State
                    if ($currentTunnelState -ne "Running") {
                        Write-Host "‚ö†Ô∏è Cloudflare tunnel –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω, –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ–º..."
                        Remove-Job -Id $tunnelJob -Force -ErrorAction SilentlyContinue
                        
                        # –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ–º —Ç—É–Ω–Ω–µ–ª—å
                        $tunnelJob = Start-Job -ScriptBlock {
                            param($cloudflaredPath, $logPath)
                            & $cloudflaredPath tunnel --url http://localhost:8080 2>&1 | Tee-Object -FilePath $logPath
                        } -ArgumentList "$env:USERPROFILE\cloudflared.exe", $logFile
                        
                        Start-Sleep -Seconds 20
                        
                        # –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –Ω–æ–≤—ã–π URL
                        $newOutput = Receive-Job -Id $tunnelJob -Keep
                        if ($newOutput) {
                            Write-Host "üîó –ù–æ–≤—ã–π –≤—ã–≤–æ–¥ Cloudflare:"
                            $newOutput | ForEach-Object { 
                                Write-Host $_
                                if ($_ -match "https://[a-zA-Z0-9\-]+\.trycloudflare\.com") {
                                    Write-Host "üéØ –ù–æ–≤—ã–π URL: $($matches[0])"
                                }
                            }
                        }
                    }
                    
                    # –ü—Ä–æ–≤–µ—Ä—è–µ–º RDP —Å–µ—Ä–≤–µ—Ä
                    $rdpPort = Get-NetTCPConnection -LocalPort 3389 -ErrorAction SilentlyContinue
                    if (-not $rdpPort) {
                        Write-Host "‚ö†Ô∏è RDP Server –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω, –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ–º..."
                        Start-Service -Name "TermService" -ErrorAction SilentlyContinue
                    }
                    
                    # –ü—Ä–æ–≤–µ—Ä—è–µ–º HTTP —Å–µ—Ä–≤–µ—Ä
                    $httpPort = Get-NetTCPConnection -LocalPort 8080 -ErrorAction SilentlyContinue
                    if (-not $httpPort) {
                        Write-Host "‚ö†Ô∏è HTTP —Å–µ—Ä–≤–µ—Ä –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –Ω–∞ –ø–æ—Ä—Ç—É 8080"
                    } else {
                        Write-Host "‚úÖ –í—Å–µ —Å–µ—Ä–≤–∏—Å—ã —Ä–∞–±–æ—Ç–∞—é—Ç"
                    }
                    
                    $lastCheck = Get-Date
                    Write-Host "‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞ - $(Get-Date -Format 'HH:mm:ss')"
                }
                
                Start-Sleep -Seconds 45
                
            } catch {
                Write-Host "‚ùå –û—à–∏–±–∫–∞ –≤ —Ü–∏–∫–ª–µ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞: $($_.Exception.Message)"
                Start-Sleep -Seconds 60
            }
        }
        
        # –≠—Ç–æ—Ç –∫–æ–¥ –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –≤—ã–ø–æ–ª–Ω–∏—Ç—Å—è, —Ç–∞–∫ –∫–∞–∫ —Ü–∏–∫–ª –±–µ—Å–∫–æ–Ω–µ—á–Ω—ã–π
        Write-Host "‚è∞ –ó–∞–≤–µ—Ä—à–∞–µ–º —Ä–∞–±–æ—Ç—É..."
        Remove-Job -Id $tunnelJob -Force -ErrorAction SilentlyContinue
